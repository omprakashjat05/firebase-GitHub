<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>üî• Firebase Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg-primary: #f5e6d3; --bg-secondary: #e8d5c4; --bg-card: #fff9f0;
      --bg-card-expired: linear-gradient(145deg, #ffdddd, #ffcccc);
      --accent: #c4956a; --accent-light: rgba(196,149,106,0.15);
      --text-primary: #333; --text-secondary: #666; --border: #d4c4b0;
      --success: #27ae60; --danger: #e74c3c;
      --header-bg: linear-gradient(135deg, #c4956a, #a67c52);
      --font-main: 'Poppins', sans-serif; --font-mono: 'Courier New', monospace;
    }
    body { font-family: var(--font-main); background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; padding-bottom: 80px; }
    
    .header { background: var(--header-bg); padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
    .header h1 { font-size: 15px; font-weight: 700; color: white; display: flex; align-items: center; gap: 8px; }
    .user-info { display: flex; align-items: center; gap: 8px; }
    .user-details { text-align: right; }
    .user-name { font-size: 11px; font-weight: 600; color: white; max-width: 80px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .user-email { font-size: 8px; color: rgba(255,255,255,0.7); max-width: 80px; overflow: hidden; text-overflow: ellipsis; }
    .user-avatar { width: 30px; height: 30px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.3); }
    .header-btn { padding: 5px 10px; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 6px; font-size: 10px; font-weight: 600; cursor: pointer; }
    
    .container { max-width: 800px; margin: 0 auto; padding: 10px; }
    .card { background: var(--bg-card); border-radius: 12px; padding: 16px; margin-bottom: 12px; }
    .card h3 { font-size: 14px; margin-bottom: 12px; color: var(--accent); }
    
    .login-card { max-width: 380px; margin: 30px auto; text-align: center; }
    .info-box { background: var(--accent-light); padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid var(--accent); text-align: left; }
    .google-btn { width: 100%; padding: 14px; background: white; color: #333; border: 2px solid #ddd; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px; margin-top: 15px; }
    .google-btn:hover { border-color: #4285f4; }
    .google-btn img { width: 20px; height: 20px; }
    .google-btn:disabled { opacity: 0.6; }
    .auth-error { background: rgba(231,76,60,0.15); color: var(--danger); padding: 10px; border-radius: 8px; margin-top: 12px; font-size: 12px; display: none; }
    
    .stats-card { display: flex; justify-content: space-around; background: var(--bg-card); border-radius: 12px; padding: 12px; margin-bottom: 12px; }
    .stat-item { text-align: center; }
    .stat-value { font-size: 20px; font-weight: 700; color: var(--accent); }
    .stat-label { font-size: 9px; color: var(--text-secondary); text-transform: uppercase; }
    
    .search-bar { display: flex; align-items: center; gap: 8px; background: var(--bg-card); border-radius: 25px; padding: 10px 14px; margin-bottom: 10px; border: 2px solid var(--border); }
    .search-bar svg { width: 16px; height: 16px; color: var(--text-secondary); }
    .search-bar input { flex: 1; background: none; border: none; color: var(--text-primary); font-size: 13px; outline: none; }
    
    .filter-tabs { display: flex; gap: 6px; margin-bottom: 10px; }
    .filter-tab { padding: 6px 14px; background: var(--bg-card); border: 2px solid var(--border); color: var(--text-secondary); font-size: 11px; font-weight: 600; cursor: pointer; border-radius: 18px; }
    .filter-tab.active { background: var(--accent); color: white; border-color: var(--accent); }
    
    .collection-selector { display: flex; gap: 6px; margin-bottom: 10px; flex-wrap: wrap; }
    .collection-btn { padding: 8px 16px; background: var(--bg-card); border: 2px solid var(--border); color: var(--text-secondary); font-size: 11px; font-weight: 600; cursor: pointer; border-radius: 20px; }
    .collection-btn.active { background: var(--accent); color: white; border-color: var(--accent); }
    
    .section-title { font-size: 12px; color: var(--accent); font-weight: 600; margin-bottom: 10px; }
    
    .device-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
    
    .device-card { background: var(--bg-card); border-radius: 10px; padding: 10px; position: relative; border-left: 4px solid var(--accent); }
    .device-card.expired { background: var(--bg-card-expired); border-left-color: var(--danger); }
    
    .position-tag { position: absolute; top: 6px; right: 6px; background: var(--accent); color: white; font-size: 8px; font-weight: 700; padding: 2px 6px; border-radius: 8px; }
    .device-card.expired .position-tag { background: var(--danger); }
    
    .device-id { font-size: 13px; color: var(--accent); font-weight: 700; margin-bottom: 2px; word-break: break-all; font-family: var(--font-mono); padding-right: 30px; }
    .device-card.expired .device-id { color: var(--danger); }
    
    .user-name-card { font-size: 16px; font-weight: 700; color: var(--text-primary); margin-bottom: 4px; }
    
    .key-value { font-size: 10px; font-family: var(--font-mono); background: var(--accent-light); color: var(--accent); padding: 5px 8px; border-radius: 5px; margin-bottom: 6px; cursor: pointer; word-break: break-all; text-align: center; }
    .device-card.expired .key-value { background: rgba(231,76,60,0.1); color: var(--danger); }
    
    .meta-row { display: flex; justify-content: space-between; align-items: center; font-size: 9px; margin-bottom: 6px; }
    .expiry-text { color: var(--text-secondary); font-weight: 500; }
    .status-badge { padding: 2px 6px; border-radius: 8px; font-size: 8px; font-weight: 600; }
    .status-badge.online { background: rgba(39,174,96,0.15); color: var(--success); }
    .status-badge.offline { background: rgba(231,76,60,0.15); color: var(--danger); }
    
    .expired-badge { display: inline-block; background: var(--danger); color: white; font-size: 8px; font-weight: 700; padding: 2px 8px; border-radius: 8px; margin-bottom: 6px; }
    
    .card-actions { display: flex; gap: 6px; align-items: center; }
    .toggle-container { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; }
    .toggle-expired-label { background: var(--danger); color: white; font-size: 8px; font-weight: 700; padding: 2px 8px; border-radius: 8px; white-space: nowrap; }
    .action-btn { flex: 1; padding: 6px; border: none; border-radius: 5px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .action-btn svg { width: 14px; height: 14px; }
    .action-btn.edit { background: rgba(52,152,219,0.15); color: #3498db; }
    .action-btn.delete { background: rgba(231,76,60,0.15); color: var(--danger); }
    
    .toggle-switch { position: relative; width: 40px; height: 22px; flex-shrink: 0; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: 0.3s; border-radius: 22px; }
    .toggle-slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: 0.3s; border-radius: 50%; }
    .toggle-switch input:checked + .toggle-slider { background-color: var(--success); }
    .toggle-switch input:checked + .toggle-slider:before { transform: translateX(18px); }
    
    .sub-tabs { display: flex; background: var(--bg-secondary); border-radius: 10px; padding: 4px; margin-bottom: 10px; }
    .sub-tab { flex: 1; padding: 8px; background: none; border: none; color: var(--text-secondary); font-size: 11px; font-weight: 600; cursor: pointer; border-radius: 8px; }
    .sub-tab.active { background: var(--accent); color: white; }
    
    .json-editor { width: 100%; min-height: 250px; background: var(--bg-secondary); border: 2px solid var(--border); border-radius: 8px; padding: 10px; font-family: var(--font-mono); font-size: 10px; color: var(--text-primary); resize: vertical; }
    .json-buttons { display: flex; gap: 5px; margin-top: 8px; }
    .json-buttons button { flex: 1; padding: 8px; border: none; border-radius: 6px; font-size: 10px; font-weight: 600; cursor: pointer; color: white; }
    .json-buttons .save { background: var(--success); }
    .json-buttons .format { background: #3498db; }
    .json-buttons .copy { background: #9b59b6; }
    .json-buttons .reset { background: #95a5a6; }
    
    .status-bar { display: flex; justify-content: space-between; align-items: center; padding: 8px 10px; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 10px; }
    .status { font-size: 10px; color: var(--text-secondary); }
    .actions button { padding: 5px 10px; background: var(--accent); color: white; border: none; border-radius: 5px; font-size: 9px; font-weight: 600; cursor: pointer; }
    
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--bg-card); display: flex; justify-content: space-around; align-items: center; padding: 8px 0 12px; border-top: 1px solid var(--border); z-index: 99; }
    .nav-item { display: flex; flex-direction: column; align-items: center; gap: 2px; color: var(--text-secondary); font-size: 9px; cursor: pointer; padding: 4px 12px; }
    .nav-item.active { color: var(--accent); }
    .nav-item svg { width: 20px; height: 20px; }
    
    .fab-button { width: 48px; height: 48px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); cursor: pointer; margin-top: -24px; border: none; }
    .fab-button svg { width: 22px; height: 22px; color: white; }
    
    #topBtn { position: fixed; right: 10px; bottom: 80px; width: 36px; height: 36px; border-radius: 50%; background: var(--bg-card); border: 2px solid var(--border); color: var(--accent); font-size: 16px; display: none; align-items: center; justify-content: center; z-index: 98; cursor: pointer; }
    
    .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(3px); display: none; align-items: flex-start; justify-content: center; padding: 6vh 12px 20px; z-index: 10000; overflow-y: auto; }
    .modal-bg.show { display: flex; }
    .modal-box { width: 100%; max-width: 380px; background: var(--bg-card); border-radius: 14px; }
    .modal-header { padding: 12px 14px; background: var(--header-bg); display: flex; justify-content: space-between; align-items: center; border-radius: 14px 14px 0 0; }
    .modal-title { font-size: 13px; font-weight: 600; color: white; }
    .modal-close { width: 26px; height: 26px; border-radius: 6px; background: rgba(255,255,255,0.2); border: none; color: white; font-size: 14px; cursor: pointer; }
    .modal-body { padding: 14px; }
    
    .modal-input-group { margin-bottom: 10px; }
    .modal-input-group label { display: block; color: var(--accent); font-weight: 600; margin-bottom: 4px; font-size: 10px; }
    .modal-input { width: 100%; padding: 9px 10px; background: white; border: 2px solid var(--border); color: var(--text-primary); border-radius: 7px; font-size: 12px; outline: none; }
    .modal-input:focus { border-color: var(--accent); }
    .modal-row { display: flex; gap: 8px; }
    .modal-row .modal-input-group { flex: 1; }
    
    .quick-btn { padding: 7px 10px; background: var(--accent); color: white; border: none; border-radius: 5px; font-size: 10px; font-weight: 600; cursor: pointer; }
    .expiry-inline { display: flex; gap: 5px; align-items: center; flex-wrap: wrap; }
    
    .checkbox-label { display: flex; align-items: center; gap: 8px; padding: 9px 10px; background: white; border: 2px solid var(--border); border-radius: 7px; cursor: pointer; font-size: 11px; }
    .checkbox-label input[type="checkbox"] { width: 15px; height: 15px; accent-color: var(--accent); }
    
    .modal-buttons { display: flex; gap: 8px; margin-top: 12px; }
    .modal-save-btn { flex: 2; padding: 11px; background: var(--accent); color: white; border: none; border-radius: 8px; font-size: 12px; font-weight: 700; cursor: pointer; }
    .modal-save-btn:disabled { opacity: 0.6; }
    .modal-cancel-btn { flex: 1; padding: 11px; background: #888; color: white; border: none; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; }
    
    .spinner { width: 12px; height: 12px; border: 2px solid white; border-top-color: transparent; border-radius: 50%; animation: spin 0.6s linear infinite; display: inline-block; margin-right: 5px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(100px); background: #333; color: white; padding: 10px 20px; border-radius: 20px; font-size: 12px; font-weight: 500; opacity: 0; transition: all 0.3s; z-index: 10001; }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    
    .empty-state { text-align: center; padding: 30px 15px; color: var(--text-secondary); grid-column: 1 / -1; }
    .empty-state button { padding: 10px 20px; background: var(--accent); border: none; border-radius: 20px; font-weight: 700; color: white; cursor: pointer; margin-top: 10px; font-size: 12px; }
    
    .suggestions { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid var(--accent); border-radius: 7px; max-height: 120px; overflow-y: auto; z-index: 1000; display: none; margin-top: 3px; }
    .suggestions.show { display: block; }
    .suggestion-item { padding: 8px 10px; cursor: pointer; border-bottom: 1px solid var(--border); font-size: 11px; }
    .suggestion-item:hover { background: var(--accent-light); }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    .theme-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top: 10px; }
    .theme-option { padding: 10px; border-radius: 8px; cursor: pointer; text-align: center; font-size: 10px; font-weight: 600; border: 2px solid transparent; }
    .theme-option.active { border-color: white; box-shadow: 0 0 10px rgba(255,255,255,0.3); }
    .theme-cream { background: linear-gradient(135deg, #c4956a, #a67c52); color: white; }
    .theme-gold { background: linear-gradient(135deg, #ffc107, #ff9800); color: #111; }
    .theme-cyber { background: linear-gradient(135deg, #00f5ff, #0080ff); color: #111; }
    .theme-matrix { background: linear-gradient(135deg, #00ff41, #00aa2a); color: #111; }
    
    .warning-msg { background: rgba(231,76,60,0.15); color: var(--danger); padding: 6px; border-radius: 5px; font-size: 10px; margin-top: 5px; display: none; }
    
    [data-theme="gold"] { --bg-primary: #1a1a1a; --bg-secondary: #0d0d0d; --bg-card: #252525; --accent: #ffc107; --text-primary: #f5f5f5; --text-secondary: #aaa; --border: #333; --header-bg: linear-gradient(135deg, #ffc107, #ff9800); }
    [data-theme="gold"] .header h1 { color: #111; }
    [data-theme="cyber"] { --bg-primary: #0a0e1a; --bg-secondary: #050810; --bg-card: #0d1220; --accent: #00f5ff; --text-primary: #e0f7ff; --text-secondary: #7fdbff; --border: #1a3a4a; --header-bg: linear-gradient(135deg, #00f5ff, #0080ff); }
    [data-theme="cyber"] .header h1 { color: #0a0e1a; }
    [data-theme="matrix"] { --bg-primary: #0a0a0a; --bg-secondary: #050505; --bg-card: #0f0f0f; --accent: #00ff41; --text-primary: #00ff41; --text-secondary: #00aa2a; --border: #00ff41; --header-bg: linear-gradient(135deg, #00ff41, #00aa2a); }
    [data-theme="matrix"] .header h1 { color: #0a0a0a; }
  </style>
</head>
<body data-theme="cream">
  <div class="header">
    <h1>üî• Firebase Admin</h1>
    <div class="user-info" id="userInfo" style="display:none;">
      <div class="user-details">
        <div class="user-name" id="userName"></div>
        <div class="user-email" id="userEmail"></div>
      </div>
      <img class="user-avatar" id="userAvatar" src="" alt="">
      <button class="header-btn" id="logoutBtn">Logout</button>
    </div>
  </div>

  <div class="container">
    <div id="loginSection">
      <div class="card login-card">
        <h3>üîê Admin Login</h3>
        <div class="info-box">
          <p style="margin:0;font-size:12px;"><strong>üîí Authorized Access Only</strong></p>
          <p style="margin:5px 0 0;font-size:11px;color:var(--text-secondary);">Only authorized administrators can access this panel.</p>
        </div>
        <button class="google-btn" id="googleLoginBtn">
          <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
          Sign in with Google
        </button>
        <div class="auth-error" id="authError"></div>
      </div>
    </div>

    <div id="mainPanel" style="display:none;">
      <div class="tab-content active" id="tab-devices">
        <div class="section-title">üìÅ Collection</div>
        <div class="collection-selector">
          <button class="collection-btn active" data-collection="Camera">üì∑ Camera</button>
          <button class="collection-btn" data-collection="Gallery">üñºÔ∏è Gallery</button>
          <button class="collection-btn" data-collection="KycRndm">üîê KycRndm</button>
        </div>

        <div class="stats-card">
          <div class="stat-item"><div class="stat-value" id="totalCount">0</div><div class="stat-label">Total</div></div>
          <div class="stat-item"><div class="stat-value" id="activeCount">0</div><div class="stat-label">Active</div></div>
          <div class="stat-item"><div class="stat-value" id="expiredCount">0</div><div class="stat-label">Expired</div></div>
        </div>

        <div class="sub-tabs">
          <button class="sub-tab active" data-subtab="keys">üîë Keys</button>
          <button class="sub-tab" data-subtab="editor">üìù JSON</button>
        </div>

        <div class="tab-content active" id="subtab-keys">
          <div class="search-bar">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
            <input type="text" placeholder="Search devices..." id="searchInput">
          </div>
          <div class="filter-tabs">
            <button class="filter-tab active" data-filter="all">üìú All</button>
            <button class="filter-tab" data-filter="active">‚úÖ Active</button>
            <button class="filter-tab" data-filter="expired">‚ö†Ô∏è Expired</button>
          </div>
          <div class="section-title">Device Keys</div>
          <div id="dataList" class="device-grid"></div>
        </div>

        <div class="tab-content" id="subtab-editor">
          <textarea class="json-editor" id="rawJsonEditor" placeholder="JSON data..."></textarea>
          <div class="json-buttons">
            <button class="save" id="updateFromJsonBtn">üì§ Save</button>
            <button class="format" id="formatJsonBtn">‚ú® Format</button>
            <button class="copy" id="copyJsonBtn">üìã Copy</button>
            <button class="reset" id="resetJsonBtn">üîÑ Reset</button>
          </div>
        </div>
      </div>

      <div class="tab-content" id="tab-settings">
        <div class="card">
          <h3>üî• Status</h3>
          <div class="status-bar">
            <div class="status" id="firebaseStatus">‚ö° Connected</div>
            <div class="actions"><button id="refreshDataBtn">üîÑ</button></div>
          </div>
        </div>
        <div class="card">
          <h3>üé® Theme</h3>
          <div class="theme-grid">
            <div class="theme-option theme-cream active" data-theme="cream">‚òÄÔ∏è Cream</div>
            <div class="theme-option theme-gold" data-theme="gold">üåü Gold</div>
            <div class="theme-option theme-cyber" data-theme="cyber">‚ö° Cyber</div>
            <div class="theme-option theme-matrix" data-theme="matrix">üíª Matrix</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="bottom-nav" id="bottomNav" style="display:none;">
    <div class="nav-item active" id="navDevices" onclick="switchToTab('devices')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
      Devices
    </div>
    <button class="fab-button" onclick="openKeyModal()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    </button>
    <div class="nav-item" id="navSettings" onclick="switchToTab('settings')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      Settings
    </div>
  </div>

  <button id="topBtn" onclick="window.scrollTo({top:0,behavior:'smooth'})">‚Üë</button>

  <div class="modal-bg" id="keyModal">
    <div class="modal-box">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">‚ûï Add Key</div>
        <button class="modal-close" onclick="closeKeyModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="modal-input-group">
          <label>üì± Device ID</label>
          <input id="deviceId" placeholder="Device ID" class="modal-input" oninput="checkDeviceIdDuplicate()" />
          <div class="warning-msg" id="deviceIdWarning">‚ö†Ô∏è Exists!</div>
        </div>
        <div class="modal-input-group">
          <label>üîë Key</label>
          <div style="display:flex;gap:5px;">
            <input id="key" placeholder="License key" class="modal-input" style="flex:1;" oninput="checkKeyDuplicate()" />
            <button class="quick-btn" onclick="generateRandomKey()">üé≤</button>
          </div>
          <div class="warning-msg" id="keyWarning">‚ö†Ô∏è Exists!</div>
        </div>
        <div class="modal-input-group">
          <label>üìÖ Expiry</label>
          <div class="expiry-inline">
            <input id="expiry" placeholder="dd-mm-yyyy" class="modal-input" style="flex:1;" />
            <button class="quick-btn" onclick="setQuickDate(7)">7d</button>
            <button class="quick-btn" onclick="setQuickDate(15)">15d</button>
            <button class="quick-btn" onclick="setQuickDate(30)">30d</button>
          </div>
        </div>
        <div class="modal-input-group">
          <div class="expiry-inline">
            <button class="quick-btn" onclick="adjustExpiry(-1)">‚àí1</button>
            <button class="quick-btn" onclick="adjustExpiry(1)">+1</button>
            <label class="checkbox-label" style="flex:1;">
              <input id="allowOffline" type="checkbox" />
              <span>Allow Offline</span>
            </label>
          </div>
        </div>
        <div class="modal-row">
          <div class="modal-input-group" style="position:relative;">
            <label>üë§ User</label>
            <input id="username" placeholder="Name" class="modal-input" autocomplete="off" />
            <div id="userSuggestions" class="suggestions"></div>
          </div>
          <div class="modal-input-group" style="position:relative;">
            <label>üìç Pos</label>
            <input id="positionInput" placeholder="#" class="modal-input" autocomplete="off" />
            <div id="positionSuggestions" class="suggestions"></div>
          </div>
        </div>
        <div class="modal-buttons">
          <button class="modal-save-btn" id="saveBtn">üî• Save</button>
          <button class="modal-cancel-btn" onclick="closeKeyModal()">‚úï</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA1FIDLD-AKVlEz-AJiweYVdxhIP0Rnijk",
      authDomain: "opjat-2005.firebaseapp.com",
      databaseURL: "https://opjat-2005-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "opjat-2005",
      storageBucket: "opjat-2005.firebasestorage.app",
      messagingSenderId: "2500552965",
      appId: "1:2500552965:web:4f6664a366967a2525af6c"
    };

    const AUTHORIZED_EMAIL = "www.webomprakashjat@gmail.com";
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();
    const provider = new firebase.auth.GoogleAuthProvider();

    let currentUser = null, currentCollection = 'Camera', currentData = [], allDataArray = [], currentUpdateId = null, currentFilter = 'all';

    const showToast = msg => { const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000); };
    const isExpired = d => { if (!d) return false; const p = d.split('-'); if (p.length !== 3) return false; return new Date(+p[2], +p[1]-1, +p[0]) < new Date(); };
    const formatDate = d => `${String(d.getDate()).padStart(2,'0')}-${String(d.getMonth()+1).padStart(2,'0')}-${d.getFullYear()}`;
    
    window.setQuickDate = days => { const d = new Date(); d.setDate(d.getDate() + days); document.getElementById('expiry').value = formatDate(d); };
    window.adjustExpiry = days => { const i = document.getElementById('expiry'); if (!i.value) return; const p = i.value.split('-'); if (p.length !== 3) return; const d = new Date(+p[2], +p[1]-1, +p[0]); d.setDate(d.getDate() + days); i.value = formatDate(d); };
    window.generateRandomKey = () => { const c = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789", e = allDataArray.map(x => x.key); let k; do { k = ""; for (let i = 0; i < 12; i++) k += c.charAt(Math.floor(Math.random() * c.length)); } while (e.includes(k)); document.getElementById('key').value = k; checkKeyDuplicate(); };
    
    function checkDeviceIdDuplicate() { const d = document.getElementById('deviceId').value.trim(), w = document.getElementById('deviceIdWarning'); if (!d || currentUpdateId) { w.style.display = 'none'; return; } w.style.display = allDataArray.find(i => (i.device_id || i.id) === d) ? 'block' : 'none'; }
    function checkKeyDuplicate() { const k = document.getElementById('key').value.trim(), w = document.getElementById('keyWarning'); if (!k) { w.style.display = 'none'; return false; } let o = null; if (currentUpdateId) { const i = allDataArray.find(x => (x.device_id || x.id) === currentUpdateId); if (i) o = i.key; } if (currentUpdateId && k === o) { w.style.display = 'none'; return false; } const e = allDataArray.find(i => i.key === k && (i.device_id || i.id) !== currentUpdateId); w.style.display = e ? 'block' : 'none'; return !!e; }
    
    window.copyKey = k => { navigator.clipboard.writeText(k); showToast('‚úÖ Copied!'); };
    
    function openKeyModal() { currentUpdateId = null; ['deviceId','key','expiry','username'].forEach(i => document.getElementById(i).value = ''); document.getElementById('allowOffline').checked = false; document.getElementById('positionInput').value = allDataArray.length + 1; document.getElementById('modalTitle').textContent = '‚ûï Add Key'; ['deviceIdWarning','keyWarning'].forEach(i => document.getElementById(i).style.display = 'none'); document.getElementById('keyModal').classList.add('show'); }
    function closeKeyModal() { document.getElementById('keyModal').classList.remove('show'); }
    function switchToTab(t) { document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active')); document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); document.getElementById(`tab-${t}`).classList.add('active'); document.getElementById(`nav${t.charAt(0).toUpperCase()+t.slice(1)}`).classList.add('active'); }

    async function signInWithGoogle() {
      const b = document.getElementById('googleLoginBtn'); b.disabled = true; b.innerHTML = '<span class="spinner"></span> Signing in...';
      document.getElementById('authError').style.display = 'none';
      try {
        const r = await auth.signInWithPopup(provider);
        if (r.user.email !== AUTHORIZED_EMAIL) { await auth.signOut(); document.getElementById('authError').textContent = '‚ùå Access Denied!'; document.getElementById('authError').style.display = 'block'; b.disabled = false; b.innerHTML = '<img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg"> Sign in with Google'; return; }
        currentUser = r.user; showMainPanel(); showToast('‚úÖ Login!');
      } catch (e) { document.getElementById('authError').textContent = '‚ùå ' + e.message; document.getElementById('authError').style.display = 'block'; b.disabled = false; b.innerHTML = '<img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg"> Sign in with Google'; }
    }

    function showMainPanel() {
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('mainPanel').style.display = 'block';
      document.getElementById('bottomNav').style.display = 'flex';
      document.getElementById('userInfo').style.display = 'flex';
      document.getElementById('userName').textContent = currentUser.displayName || 'Admin';
      document.getElementById('userEmail').textContent = currentUser.email;
      document.getElementById('userAvatar').src = currentUser.photoURL || '';
      loadCollectionData();
    }

    async function signOut() { if (confirm('Logout?')) { await auth.signOut(); location.reload(); } }
    auth.onAuthStateChanged(u => { if (u && u.email === AUTHORIZED_EMAIL) { currentUser = u; showMainPanel(); } });

    function loadCollectionData() {
      document.getElementById('firebaseStatus').textContent = 'üîÑ Loading...';
      const ref = database.ref(currentCollection); ref.off();
      ref.on('value', s => {
        const d = s.val();
        if (Array.isArray(d)) currentData = d.filter(i => i !== null);
        else if (d && typeof d === 'object') currentData = Object.keys(d).map(k => ({ id: k, ...d[k] }));
        else currentData = [];
        allDataArray = currentData; displayData();
        document.getElementById('rawJsonEditor').value = JSON.stringify(currentData, null, 2);
        document.getElementById('firebaseStatus').textContent = '‚úÖ Connected';
      });
    }

    async function saveData() {
      document.getElementById('firebaseStatus').textContent = 'üì§ Saving...';
      try { await database.ref(currentCollection).set(currentData); document.getElementById('firebaseStatus').textContent = '‚úÖ Saved'; return true; }
      catch (e) { alert('‚ùå ' + e.message); document.getElementById('firebaseStatus').textContent = '‚ùå Error'; return false; }
    }

    function displayData(s = '') {
      const l = document.getElementById('dataList'); l.innerHTML = '';
      let t = allDataArray.length, a = 0, e = 0;
      allDataArray.forEach(i => { if (isExpired(i.expirydate)) e++; else a++; });
      document.getElementById('totalCount').textContent = t;
      document.getElementById('activeCount').textContent = a;
      document.getElementById('expiredCount').textContent = e;

      let f = allDataArray;
      if (currentFilter === 'active') f = f.filter(i => !isExpired(i.expirydate));
      else if (currentFilter === 'expired') f = f.filter(i => isExpired(i.expirydate));
      if (s) { const sl = s.toLowerCase(); f = f.filter(i => (i.device_id||i.id||'').toLowerCase().includes(sl) || (i.user||'').toLowerCase().includes(sl) || (i.key||'').toLowerCase().includes(sl)); }

      if (!f.length) { l.innerHTML = '<div class="empty-state"><p>No keys</p><button onclick="openKeyModal()">‚ûï Add</button></div>'; return; }

      f.forEach(item => {
        const did = item.device_id || item.id || '?', exp = isExpired(item.expirydate), pos = allDataArray.findIndex(d => (d.device_id||d.id) === did) + 1, en = !exp;
        const div = document.createElement('div');
        div.className = 'device-card' + (exp ? ' expired' : '');
        div.innerHTML = `
          <div class="position-tag">#${pos}</div>
          <div class="device-id">${did}</div>
          <div class="user-name-card">${item.user || 'N/A'}</div>
          <div class="key-value" onclick="copyKey('${item.key||''}')">${item.key || 'N/A'}</div>
          <div class="meta-row">
            <span class="expiry-text">${item.expirydate || 'N/A'}</span>
            ${exp ? '<span class="status-badge" style="background: var(--danger); color: white;">‚ö†Ô∏è EXPIRED</span>' : '<span class="status-badge ' + (item.Allowoffline ? 'offline' : 'online') + '">' + (item.Allowoffline ? 'OFFLINE' : 'ONLINE') + '</span>'}
          </div>
          
          <div class="card-actions">
            <button class="action-btn edit" onclick="updateItem('${did}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button>
            <button class="action-btn delete" onclick="deleteItem('${did}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>
            <div class="toggle-container">
              ${!en ? '<div class="toggle-expired-label">‚ö†Ô∏è DISABLED</div>' : ''}
              <label class="toggle-switch"><input type="checkbox" ${en ? 'checked' : ''} onchange="toggleEnable('${did}', this.checked)"><span class="toggle-slider"></span></label>
            </div>
          </div>`;
        l.appendChild(div);
      });
    }

    window.toggleEnable = async (id, en) => {
      const idx = currentData.findIndex(i => (i.device_id||i.id) === id);
      if (idx === -1) return;
      const p = (currentData[idx].expirydate || '01-01-2026').split('-');
      currentData[idx].expirydate = `${p[0]}-${p[1]}-${en ? '2026' : '20XX'}`;
      if (await saveData()) { allDataArray = currentData; displayData(document.getElementById('searchInput').value); showToast(en ? '‚úÖ Enabled!' : 'üö´ Disabled!'); }
    };

    window.updateItem = id => {
      currentUpdateId = id;
      const i = currentData.find(e => (e.device_id||e.id) === id);
      if (i) {
        document.getElementById('deviceId').value = i.device_id || id;
        document.getElementById('key').value = i.key || '';
        document.getElementById('expiry').value = i.expirydate || '';
        document.getElementById('username').value = i.user || '';
        document.getElementById('allowOffline').checked = i.Allowoffline || false;
        document.getElementById('positionInput').value = allDataArray.findIndex(x => (x.device_id||x.id) === id) + 1;
        document.getElementById('modalTitle').textContent = '‚úèÔ∏è Update';
        ['deviceIdWarning','keyWarning'].forEach(w => document.getElementById(w).style.display = 'none');
        document.getElementById('keyModal').classList.add('show');
      }
    };

    window.deleteItem = async id => {
      if (confirm(`Delete ${id}?`)) {
        const idx = currentData.findIndex(i => (i.device_id||i.id) === id);
        if (idx !== -1) currentData.splice(idx, 1);
        if (await saveData()) { allDataArray = currentData; displayData(); showToast('üóë Deleted!'); }
      }
    };

    document.getElementById('googleLoginBtn').addEventListener('click', signInWithGoogle);
    document.getElementById('logoutBtn').addEventListener('click', signOut);

    document.querySelectorAll('.collection-btn').forEach(b => b.addEventListener('click', () => {
      document.querySelectorAll('.collection-btn').forEach(x => x.classList.remove('active'));
      b.classList.add('active'); currentCollection = b.dataset.collection; loadCollectionData(); showToast(`üìÅ ${currentCollection}`);
    }));

    document.getElementById('saveBtn').addEventListener('click', async () => {
      const b = document.getElementById('saveBtn'), id = document.getElementById('deviceId').value.trim(), k = document.getElementById('key').value.trim(), ex = document.getElementById('expiry').value.trim(), u = document.getElementById('username').value.trim(), ao = document.getElementById('allowOffline').checked, ps = parseInt(document.getElementById('positionInput').value) || (allDataArray.length + 1);
      if (!id || !k || !ex || !u) { alert('‚ö†Ô∏è Fill all!'); return; }
      if (checkKeyDuplicate()) return;
      b.disabled = true; b.innerHTML = '<span class="spinner"></span>';
      const entry = { device_id: id, key: k, expirydate: ex, user: u, Allowoffline: ao };
      let arr = [...allDataArray];
      if (currentUpdateId) { const idx = arr.findIndex(i => (i.device_id||i.id) === currentUpdateId); if (idx !== -1) arr.splice(idx, 1); }
      arr.splice(ps - 1, 0, entry); currentData = arr;
      if (await saveData()) { allDataArray = currentData; displayData(); closeKeyModal(); showToast(currentUpdateId ? '‚úÖ Updated!' : '‚úÖ Added!'); }
      b.disabled = false; b.innerHTML = 'üî• Save'; currentUpdateId = null;
    });

    document.getElementById('searchInput').addEventListener('input', e => displayData(e.target.value));
    document.querySelectorAll('.filter-tab').forEach(t => t.addEventListener('click', () => { document.querySelectorAll('.filter-tab').forEach(x => x.classList.remove('active')); t.classList.add('active'); currentFilter = t.dataset.filter; displayData(document.getElementById('searchInput').value); }));
    document.querySelectorAll('.sub-tab').forEach(t => t.addEventListener('click', () => { document.querySelectorAll('.sub-tab').forEach(x => x.classList.remove('active')); document.querySelectorAll('#tab-devices > .tab-content').forEach(c => c.classList.remove('active')); t.classList.add('active'); document.getElementById(`subtab-${t.dataset.subtab}`).classList.add('active'); }));

    document.getElementById('updateFromJsonBtn').addEventListener('click', async () => { try { currentData = JSON.parse(document.getElementById('rawJsonEditor').value); if (await saveData()) { allDataArray = currentData; displayData(); showToast('‚úÖ Saved!'); } } catch (e) { alert('‚ùå Invalid JSON!'); } });
    document.getElementById('formatJsonBtn').addEventListener('click', () => { try { document.getElementById('rawJsonEditor').value = JSON.stringify(JSON.parse(document.getElementById('rawJsonEditor').value), null, 2); showToast('‚ú® Formatted!'); } catch (e) { alert('‚ùå Invalid JSON!'); } });
    document.getElementById('copyJsonBtn').addEventListener('click', () => { document.getElementById('rawJsonEditor').select(); document.execCommand('copy'); showToast('üìã Copied!'); });
    document.getElementById('resetJsonBtn').addEventListener('click', () => { document.getElementById('rawJsonEditor').value = JSON.stringify(currentData, null, 2); showToast('üîÑ Reset!'); });
    document.getElementById('refreshDataBtn').addEventListener('click', () => { loadCollectionData(); showToast('üîÑ Refreshed!'); });

    document.querySelectorAll('.theme-option').forEach(o => o.addEventListener('click', () => { document.querySelectorAll('.theme-option').forEach(x => x.classList.remove('active')); o.classList.add('active'); document.body.setAttribute('data-theme', o.dataset.theme); localStorage.setItem('theme', o.dataset.theme); }));

    document.getElementById('username').addEventListener('input', function() { const v = this.value.toLowerCase(), s = document.getElementById('userSuggestions'); s.innerHTML = ''; if (!v) { s.classList.remove('show'); return; } const m = [...new Set(allDataArray.map(x => x.user).filter(u => u && u.toLowerCase().includes(v)))].slice(0, 5); if (!m.length) { s.classList.remove('show'); return; } m.forEach(n => { const d = document.createElement('div'); d.className = 'suggestion-item'; d.textContent = n; d.onclick = () => { document.getElementById('username').value = n; s.classList.remove('show'); }; s.appendChild(d); }); s.classList.add('show'); });
    document.getElementById('positionInput').addEventListener('input', function() { const v = this.value.toLowerCase(), s = document.getElementById('positionSuggestions'); s.innerHTML = ''; if (!v || /^\d+$/.test(v)) { s.classList.remove('show'); return; } const m = allDataArray.filter(i => (i.user||'').toLowerCase().includes(v)).slice(0, 5); if (!m.length) { s.classList.remove('show'); return; } m.forEach(i => { const p = allDataArray.findIndex(d => (d.device_id||d.id) === (i.device_id||i.id)) + 1, d = document.createElement('div'); d.className = 'suggestion-item'; d.innerHTML = `<strong>#${p}</strong> - ${i.user}`; d.onclick = () => { document.getElementById('positionInput').value = p; s.classList.remove('show'); }; s.appendChild(d); }); s.classList.add('show'); });
    document.addEventListener('click', e => { if (!document.getElementById('username').contains(e.target)) document.getElementById('userSuggestions').classList.remove('show'); if (!document.getElementById('positionInput').contains(e.target)) document.getElementById('positionSuggestions').classList.remove('show'); });

    window.addEventListener('scroll', () => { document.getElementById('topBtn').style.display = window.scrollY > 200 ? 'flex' : 'none'; });
    const st = localStorage.getItem('theme'); if (st) { document.body.setAttribute('data-theme', st); document.querySelectorAll('.theme-option').forEach(o => o.classList.toggle('active', o.dataset.theme === st)); }
  </script>
</body>
</html>
